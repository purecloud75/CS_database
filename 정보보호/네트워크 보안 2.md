# 네트워크 보안

<br/>

**스니핑 공격**

일종의 도청이다.  

유선 랜을 통한 스니핑 공격을 살펴보자.  

<br/>

**1. 원리**

공격 대상이 속한 LAN 안에 호스트들과 포트로 연결되어있는 스위치가 있다.

이 스위치의 임의의 한 포트에 해커가 스니퍼(스니핑을 하는 호스트)를 연결한 것이다.

이 포트를 통해서 랜덤 형태로 생성한 MAC 주소를 가진 패킷을 스위치에 무한대로 보내면

포트와 MAC 주소가 매핑되어 기록되어있는 이더넷용 표의 저장용량을 초과하게 되어 스위칭 기능을 상실시킨다. 

즉, 더미 허브로 만든다. 이를 **스위치 재밍 공격**이라고 한다.

<br/>


더미 허브는 한 포트로 들어온 패킷을 다른 포트에 연결되어있는 모든 호스트에게 보내는 브로드캐스트 방식을 차용하므로

한 호스트가 스위치로 패킷을 보내게 되면, 이는 다른 포트에 연결되어있던 라우터, 다른 호스트들 그리고 **스니퍼로 까지 브로드캐스트!**

스니퍼는 LAN 카드의 모드를 프러미스큐어스 모드로 바꿈으로써 수신처 MAC주소와 IP주소가 

본인과 다른 MAC 주소와 IP 주소인 패킷이면 폐기하는 이더넷의 기본 원리인 **필터링 기능을 해제**한다. 

이렇게 해당 LAN 내에서 오가는 모든 패킷을 엿볼 수 있는 것이다.

![화면 캡처 2022-09-24 150650](https://user-images.githubusercontent.com/93998875/192087583-59806147-f685-4ae5-ae6a-27a3c8ad47b2.png)


<br/>

**2. 탐지**

스니퍼가 프러미스큐어스 모드에서 작동한다는 점을 이용해야 한다.

<br/>

1. ping

의심이 가는 호스트에 ping을 보내는데, 존재하지 않는 MAC 주소를 가진 ping 을 보낸다.

만약 이에 대한 ICMP Reply가 온다면 이를 회신한 호스트가 바로 스니퍼인 것이다. 정상 호스트라면 이 ping을 폐기하기 때문이다.

![화면 캡처 2022-09-24 150703](https://user-images.githubusercontent.com/93998875/192094162-4da9f340-a00d-451b-90a2-2a2bdf2fdbb2.png)


<br/>

2. ARP

위와 유사하게 위조된ARP 리퀘스트를 보냈을 때 응답이 온다면 이 호스트는 프러미스큐어스 모드구나, 스니퍼구나 탐지

<br/>

3. DNS

테스트 대상 네트워크로 ping sweep을 보내고 들어오는 Reverse-DNS lookup을 감시하여 스니퍼를 탐지

<br/>

4. 유인

스니핑의 주요목적은 **아이디와 패스워드** 획득이다.

보안 관리자는 가짜 아이디와 패스워드를 네트워크에 계속 뿌리고, 공격자가 이것으로 접속을 시도핼 때 스니퍼를 탐지

<br/>

5. ARP watch

MAC 주소와 IP 주소의 매칭값을 초기에 저장하고 ARP 트래픽을 모니터링하여 이를 변하게 하는 패킷이 탐지되면

관리자에게 메일로 알려주는 툴이다. 대부분의 공격은 위조된 ARP를 사용하기에 쉽게 탐지

<br/><br/><br/>

**스푸핑 공격**

일종의 속이는 것이다.

<br/>

1. ARP 스푸핑 공격

<br/>

* LAN에 있는 공격자가 같은 LAN에서 통신하고 있는 클라이언트와 서버에게 서로의 MAC 주소를 

  공격자 자신의 MAC 주소라고 속여서 알린다.   
  
  서버와 클라이언트가 상대방의 MAC 주소라고 알고 있는 것이 사실은 공격자의 MAC 주소인 것이다.  
  
  그래서 둘 사이의 패킷은 모두 공격자로 오고, 공격자는 이를 다 수신한 뒤 둘에게 다시 보내줌으로써 통신에 오류가 없게끔 한다.
  
  ![화면 캡처 2022-09-24 150738](https://user-images.githubusercontent.com/93998875/192094321-5edc972a-e231-4766-8b3b-d220717d7332.png)
  
* 서버나 클라이언트측의 호스트에 있는 ARP 테이블에 arp -s [IP][MAC] 명령을 하면 되지만 일일이 번거롭고 근본적 해결책이 없다.

<br/><br/>

2. IP 스푸핑 공격

<br/>

* 트러스트 관계를 맺고 있는 서버와 클라이언트를 확인하고, 클라이언트에 DoS를 취해 다운시킨 후 IP 주소를 탈취하여  
  본인이 클라이언트인 척 서버와 통신을 하는 기법이다.
  
* 트러스트란? 
  클라이언트의 정보를 서버에 미리 기록해두고 그에 합당한 클라이언트가 서버에 접근하면  
  아이디와 패스워드의 입력없이 로그인을 허락하는 인증법이다.
  
* 해결책은 트러스트를 이용하지 않는 것이다.

<br/><br/>

3. ICMP 리다이렉트 공격

<br/>

* 네트워크 계층에서 스니핑 시스템을 네트워크에 존재하는 또 다른 라우터라고 알림으로써 패킷의 흐름을 바꾸는 공격이다.
* 로드 밸런싱 이라고 해서 하나의 네트워크에 2개 이상의 라우터 게이트웨이를 운영하여 부하를 분산하는 기법에서 그 개념이 나왔다.
![화면 캡처 2022-09-24 150800](https://user-images.githubusercontent.com/93998875/192094658-33317ff5-101f-4533-b051-8d00c9d6fa24.png)

* 호스트 A는 기본 게이트웨이로 설정된 라우터 A로 호스트 B가 목적지인 패킷을 보낸다.

  라우터 A는 자신보다는 라우터 B를 통해 전송하는 것이 더 효율적이라 판단해서 이 패킷을 라우터 B로 보낸다.
  
  라우터 A는 호스트 A가 호스트 B로 패킷을 보낼 때는 라우터 B를 기본 게이트웨이로 해서 바로 보내라는 의미로  
  ICMP 리다이렉트 패킷을 보낸다.
  
  이를 받은 호스트 A는 후에 호스트 B로 전송하고자 하면 라우터 B로 직행으로 전송한다.
  
  ![화면 캡처 2022-09-24 150809](https://user-images.githubusercontent.com/93998875/192094803-a4afead7-f0b4-4465-8972-e40f709c1e6a.png)
  
* 여기서 공격자 즉, 스니핑 시스템은 라우터 B가 되는 것이다.
* 특정 IP로 나가는 패킷의 라우팅 경로를 공격자 자신의 주소로 위조한 ICMP 리다이렉트 메시지를 생성하여 공격 대상에게 전송한다.
* 패킷을 수신한 공격 대상은 자신의 라우팅 테이블에 특정 목적지로 나가는 게이트웨이 주소를 변경한다.
* ICMP 메시지는 게이트웨이만 보낼 수 있으므로 공격자는 송신처 IP 주소를 기존의 게이트웨이의 주소로 위조(spoofing)한다.
* 그래서 특정 IP를 목적지로 패킷 전송 시 공격자 PC로 패킷이 라우팅되어 공격자는 스니핑을 한다. 

<br/><br/>

4. DNS 스푸핑 공격

<br/>

* 실제 DNS 서버보다 빨리 공격 대상에게 DNS 응답을 보내어 공격 대상이 잘못된 IP 주소로 웹 접속을 하도록 유도하는 공격.

* 공격 대상이 자주 사용하는 웹 사이트를 알아내어, 웹 서버를 만든 뒤 해당 사이트를 웹 크롤러로 긁어내고 여기에서 입력한

  아이디와 패스워드가 원래 사이트로 전달되도록 코딩을 한다. DNS 스푸핑을 통해 위조된 사이트로 접속한 공격 대상은 
  
  로그인창에 본인의 정보를 기입할 것이고, 공격자는 손 하나 까딱 안하고 원래 사이트에 남의 정보로 로그인을 성공한다. 정보 탈취 성공!
  
  
* 공격 대상과 같은 LAN에 속한 공격자는 사전에 ARP 스푸핑 등의 방식을 통해 공격 대상이 DNS 서버에 보내는 DNS 쿼리를 받는다.

  공격자가 지리적으로 더 가깝기 때문에 DNS 서버에서 온 진짜 DNS 응답보다 위조한 DNS 응답이 더 빨리 클라이언트에 도달할 것이다.
  
  DNS 메시지는 UDP 방식이므로 세션과정이 없어서 단순히 먼저 온 메시지를 진짜라고 믿고, 그 후에 오는 것들은 다 폐기 시킨다.
  
  이로써 위조된 DNS 응답에 적힌 IP 주소(공격자가 똑같이 만든 위조 사이트의 IP 주소)를 받아 이것을 바탕으로 접속을 하게 된다.

![화면 캡처 2022-09-24 150823](https://user-images.githubusercontent.com/93998875/192096066-5ba386bf-caf1-4c02-8ce1-54cf48381d01.png)


* URL에 대한 IP 주소를 확인할 때 처음부터 DNS에 쿼리를 던지는 게 아니라 먼저 시스템 메모리, hosts 파일을 살핀다.
* 고로, hosts 파일에 중요 접속 서버의 URL에 대한 IP 주소를 미리 등록함으로써 어느정도는 예방할 수 있다.

<br/><br/><br/>

**세션 하이재킹 공격**

<br/>

* 두 컴퓨터 간의 활성화된 상태를 뜻하는 세션을 말 그대로 가로채는 것이다.
* 서버와 클라이언트에 각각 잘못된 시퀀스 넘버를 사용해서 혼란을 준 뒤 그 틈에 자신이 끼어드는 것이다.

* 사전에 ARP 스푸핑 등을 통해 공격자는 세션이 형성된 클라이언트와 서버 사이의 패킷이 공격자 자신을 지나가게 한다.

  서버에 클라이언트 주소(사실은 공격자의 주소)로 연결을 재설정하기 위한 RST reset 패킷을 보낸다.
  
  이를 받은 서버는 시퀀스 넘버가 재설정된 것으로 판단하고 다시 TCP 3 웨이-핸드셰이킹을 수행한다.
  
  공격자는 클라이언트을 대신하여 기존에 연결 되어있던 TCP 연결(세션)을 그대로 물려 받는다.


* 이런 식으로 아이디와 패스워드 입력 없이 세션을 그대로 획득할 수 있다.
* 텔넷보다는 SSH 와 같이 인증 수준이 높은 프로토콜을 이용하여 서버에 접근해야 한다. arp -s [IP][MAC] 명령도 좋다.

<br/><br/><br/>

**무선 네트워크 보안**

<br/>

무선 LAN을 사용하려면 내부의 유선 네트워크에 AP(Access Point)장비를 설치해야 한다.

확장된 무선 네트워크는 AP를 설치한 위치에 따라서 통신 영역이 결정된다. 무선 LAN은 802.11 프로토콜을 이용한다.

![화면 캡처 2022-09-24 150858](https://user-images.githubusercontent.com/93998875/192132122-20742dd8-c81b-491a-a673-e14ba736528e.png)확장

<br/>

몇 가지 보안 방법을 소개한다.

<br/>

우선 첫 번째는 **AP장치를 물리적으로 숨겨놓는 것**이다.

혹은 카페에서 노트북을 쓰고싶을 때는 카페의 와이파이를 네트워크 목록에서 찾아서 패스워드를 입력해서 AP에 접속    
(정확히는 AP가 속해있는 카페 내 유선 LAN에 접속)하는데, 목록을 구성하는 각각의 이름을 SSID 라고 한다.  
즉, 무선 LAN을 식별하기 위한 요소로, SSID를 통해 확인한 AP로 접속한다.  
보통은 AP에서 SSID를 브로드캐스트하기에 AP의 영역에 들어온 단말기는 누구나 AP가 구성하는 무선 LAN에 접속할 수 있는데  
바로 이 **SSID 브로드캐스트를 막는 것**이다.

무선 LAN 통신을 암호화하기 위해 RC 4 암호화 알고리즘을 기본으로 하는 **WEP**을 사용한다.

하지만 이는 단점이 많아서 후에 **WPA-PSK** 방식이 차용되었고 후에는 **802.1x/EAP** 방식을 이용한다.

![화면 캡처 2022-09-24 150959](https://user-images.githubusercontent.com/93998875/192132397-5518446b-07cb-4fee-a683-541f1a220c21.png)  

802.1x/EAP와 RADIUS 서버를 이용한 무선 LAN 사용자 인증을 거친다.


