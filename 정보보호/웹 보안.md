# 웹 보안

---
## 웹의 이해
- 웹의 정식 명칭은 World Wide Web로, 세계 규모의 거미집 모양의 망이라는 뜻이다.  
- 다른 문서와 연관 관계를 가진 텍스트를 의미하는 `하이퍼텍스트`를 이용하면  
  단어나 문구를 마우스로 클릭하여 관련 주제에 대한 정보를 추가로 얻을 수 있다.  
- 현재 웹 문서로 가장 많이 쓰이는 HTML은 하이퍼텍스트를 효과적으로 전달하기 위한 스크립트 언어이다.  

### HTTP   
- 웹에 접근하려면 크롬, 사파리와 같은 웹 브라우저가 필요하다.    
- 웹에서 가장 흔히 쓰이는 프로토콜은 HTTP 이다.

#### HTTP Request  
웹 서버에 데이터를 요청하거나 전송할 때 보내는 패킷으로 GET, POST와 같은 메소드를 주로 쓴다.  

1. GET 방식 : 가장 일반적인 HTTP 리퀘스트 형태로, 요청 데이터의 인수를 웹 브라우저의 URL을 통해 전송한다.  
  www.wishfree.or.kr/list.php?page=1&search=test  
  각각의 이름과 값을 &로 결합하고, 글자수는 255자로 제한한다.  
  이 방식은 데이터가 주소 입력란에 표시되기 때문에 최소한의 보안도 유지되지 않는다.  
  
2. POST 방식 : URL에 요청 데이터를 기록하지 않고, HTTP 헤더에 데이터를 전송하기에 최소한의 보안성은 갖추고 있다.   
  내부의 구분자가 파라미터(이름과 값)을 구분하고, 서버가 각 구분자에 대한 내용을 해석하여 데이터를  
  처리하기 때문에 GET 방식에 비해 처리 속도가 상대적으로 느리다.  
  게시판의 글 보기는 GET을, 게시글을 저장,수정,삭제하거나 대용량의 데이터를 전송할 때는 POST 방식을 쓴다.
  
#### HTTP Response  
클라이언트의 HTTP Request에 대한 응답이다.  
헤더에는 프로토콜 버전, 실행 결과 코드 등이 담겨있으며, 헤더 정보 뒤에는 실제 데이터(HTML, Image)가 전달된다.  
데이터 전달이 끝나면 서버는 연결을 끊는다.  


### HTML  
- 웹 서비스는 HTML과 같은 웹 언어를 통해 제공된다.  
- 웹 서버에 HTML 문서를 저장하고 있다가 클라이언트가 특정 HTML 페이지를 요청하면 해당 문서를 클라이언트에 전송한다.  
- 클라이언트는 이 웹 페이지를 웹 브라우저를 이용하여 화면에 표현하는데, 이런 웹 페이지를 `정적인 웹 페이지` 라고 한다.  
- 사용자들의 다양한 요구를 충족하고자 자바스크립트와 같이 `동적인 페이지`를 제공하는 스크립트인 CSS가 개발되었다.  
- 웹 페이지를 요청하면 서버가 이를 주는데, 웹브라우저가 HTML을 파싱하다가 JS부분이 나왔네? 이 부분을 요청해야지 해서 재요청  
  을 하면 서버는 JS에 해당하는 스크립트 파일을 준다.   

<br/>

---
## 웹 해킹의 이해

- 웹 해킹을 할 때 `웹 프록시` 툴을 이용한다.  
- 보통 클라이언트에 설치되고, 클라이언트의 통제를 받는다.  
- 클라이언트가 웹 서버와 웹 브라우저 간에 전달되는 모든 HTTP 패킷을 웹 프록시를 통해 확인하면서 수정이 가능하다.  
- 웹 해커가 되려면 많은 시간을 들여 사이의 패킷을 읽어봄으로써 전송되는 데이터의 의미와 역할을 파악해야 한다.
- 사실 보는 것 뿐만아니라 패킷을 위조, 변조할 수도 있다.

### 서버 -> 클라이언트 패킷 변조

웹 프록시를 통해 확인하는 것은 HTTP 패킷이고, 그의 Body부분에 있을 HTML 파일이다.  
HTML 파일의 일부를 수정하여 마저 웹 브라우저로 보내면 거기선 위조된 웹 페이지를 화면에 출력한다.  

<img src="https://user-images.githubusercontent.com/93998875/198835155-80321f13-e9fb-4964-8a4a-dfea55807b1d.png" width="70%" height="70%"/>  

이러한 공격은 서버에서 클라이언트에 정보를 전송했다가 이를 다시 전송받아 처리하는 경우에 위력을 발휘한다.  
서버에서 변수 A의 값이 20임을 확인하고 이 값을 클라이언트에 전송한다.  
서버는 변수 A가 필요할 때 자신의 DB에서 다시 읽지 않고, 클라이언트가 관련 서비스를 수행할 때 서버에 다시  
전송해주는 A 값을 참조하여 서비스를 수행한다. 

<img src="https://user-images.githubusercontent.com/93998875/198839472-2fb49442-2f13-4dbe-a81b-834660d3963a.png" width="70%" height="70%"/>  


### 클라이언트 -> 서버 패킷 변조

HTTP 패킷의 헤더부분에 요청하고자 하는 페이지의 URI가 있을 것이다. 
그 곳의 인수를 수정하여 원래와는 다른 웹 페이지를 요청할 수도 있다.  
만약 URI를 수정하여 요청한 웹 페이지가 비밀 글이라면 원래는 접근이 안되는 거였지만 불법적으로 접근하게 되는 것이다.  

<img src="https://user-images.githubusercontent.com/93998875/198835164-d818bd47-aee8-4516-8de9-f252cf8a3c25.png" width="70%" height="70%"/>  


<br/>

---
## 웹의 주요 취약점

### 1. 명령 삽입 취약점
- 서버가 요청을 처리하기 위해 전송받는 인수에 특정 명령을 실행할 수 있는 코드가 포함된 경우이다.  
- 일반적으로 `SQL 삽입 공격`이 있는데, `전송되는 인수에 추가적인 실행을 위한 코드를 넣는 것`을 말한다.
- 웹 서버는 DB와 통신하기 위해 SQL 쿼리를 사용하는데, 여기에 아이디나 패스워드나 검색어 등 여러 인수가 사용된다.  
  웹에서 로그인을 할 때, 클라이언트로부터 입력받은 아이디와 패스워드를 확인하기위해 웹서버는 이들를 인수로 하여 DB에  
  SQL 쿼리를 날린다. 일치하는 정보가 있다면 결과값을 출력하고, 출력된 아이디로 로그인이 수행되는 방식이다.
  
  ```bash
  SELECT * FROM "uesrs"
  WHERE e_mail_addresss = 'wishfree@empas.com' and password = '1234'
  ```
  
- 어떤 수단을 쓰든 SQL의 결과값이 NULL이 나오지않고, 출력값이 나오기만 하면 로그인에 성공할 수 있다는 것을 이용한다.
- WHERE의 조건문을 항상 참으로 만들면 되는데, 바로 조건값에 `'or''='`을 입력하는 것이다. 아이디만 알고도 로그인을 할 수 있다.

  ```bash
  SELECT * FROM "uesrs"
  WHERE e_mail_addresss = 'wishfree@empas.com' and password = ''or''=''
  ```
  
<br/>
  
### 2. 인증 및 세션 관리 취약점
- 패스워드를 단순하게 만드는 경우다. 
  대표적인 것이 웹 개발자가 admin/admin 과 같이 단순하게 만들어놓고 지우지 않는 경우이다. 
  
- 쿠키와 같은 세션 값과 관련된 경우도 있다.  
- 사용자는 정상적인 아이디와 패스워드를 입력하고, 인증이 되었기에 인증 값으로 쿠키와 같은 세션값을 서버로부터 받는다.  
  사용자는 인증 후 새로운 페이지에 접근하게 되는데, 공격자는 세션 인증 값은 그대로 사용하고  
  아이디의 성격을 띠는 UserNo 값만 변경하여 `마치 다른 계정으로 로그인한 것처럼` 웹 서비스를 이용할 수 있다.
- 이러한 동작 방식은 연결 허용과 사용자 구분의 연계가 명확하지 않은 경우에 해당한다.
- 이러한 문제는 최초 인증 이후에는 인증과 신분 증명 역할을 클라이언트에 넘겼기 때문에 발생한다.

<img src="https://user-images.githubusercontent.com/93998875/198841639-16cf1d22-5acb-476e-b27c-b120993184f6.png" width="70%" height="70%"/>

<br/>

### 3. XSS 취약점
- `공격자가 작성한 스크립트`가 다른 사용자에게 전달되는 것이다.
- 다른 사용자의 웹 브라우저 안에서 적절한 검증 없이 실행되기 때문에 사용자의 세션을 탈취하거나  
  웹 사이트를 변조하고 악의적인 사이트로 사용자를 이동시킬 수 있다.

1. 보안이 취약한 웹 서버에 미리 작성한 XSS 코드를 저장한다. 게시판의 업로드 기능 등을 통해서 말이다.
2. 해당 웹 서버가 제공하는 웹 서비스를 이용하기 위해 아무것도 모르는 사용자는 웹 페이지 요청을 한다.
3. 응답으로 받은 웹 페이지를 웹 브라우저는 해석하며 화면에 출력하다가, HTML 코드 중간에 스크립트 링크가 있길래 다시 요청을 한다.
4. 이 때 오는 응답이 바로 XSS 코드이다.
5. XSS 코드가 사용자의 시스템에서 실행되면서 공격이 시작된다.

<img src="https://user-images.githubusercontent.com/93998875/198842187-5fdbdf09-6bba-43d1-819a-dc82fdeed279.png" width="70%" height="70%"/>

<br/>

### 4. 취약한 접근 제어
- 대표적으로 디렉터리 탐색이 있다.
- 웹 브라우저에서 확인 가능한 경로의 상위를 탐색하여 특정 시스템 파일을 다운로드하는 공격 방법이다.
- 파일 다운로드 전용 프로그램을 작성하여 사용할 때는 `.. 이나 /` 와 같은 특수 문자에 대한 필터링이 필수이다.

<br/>

### 5. 보안 설정 오류
- 디렉터리 리스팅
  - 웹 브라우저에서 웹 서버의 특정 디레터리를 열면 그 디렉터리에 있는 파일과 목록이 모두 나열되는 것을 말한다.
- 백업 및 임시 파일 존재
- 미흡한 주석 관리
- 파일 업로드 제한을 두지 않음
  - 클라이언트에서 서버로 임의의 파일을 보낼 수 있다는 것은 웹 서버의 가장 치명적인 취약점이다.
  - 공격자는 웹 서버에 악의적인 파일을 전송하며, 원격지에서 해당 파일을 실행하여 웹 서버를 장악하고  
    추가적인 내부 침투 공격을 수행할 수 있기 때문이다. 게시판에 첨부 파일로 악의적인 파일을 업로드하고 실행하는 것이다.
- **리버스 텔넷**
